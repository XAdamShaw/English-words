# Bugä¿®å¤ï¼šè·³è½¬åˆ°æŒ‡å®šè¡Œå¤±è´¥

## ğŸ› é—®é¢˜æè¿°

### é—®é¢˜1ï¼šæ’åºå¯¼è‡´çš„ç´¢å¼•æ˜ å°„é”™è¯¯
ä½¿ç”¨slideræˆ–è¾“å…¥æ¡†è·³è½¬åˆ°ç¬¬4749è¡Œæ—¶ï¼Œæ§åˆ¶å°æŠ¥é”™ï¼š
```
script.js:540 æ— æ³•æ‰¾åˆ°è¡Œ 4749 å¯¹åº”çš„å¡ç‰‡
```

### é—®é¢˜2ï¼šå‘åè·³è½¬å¤±è´¥
```
ç¬¬1æ¬¡ï¼šè·³è½¬åˆ°8767è¡Œï¼ˆæ‰¹æ¬¡88ï¼‰âœ… æˆåŠŸ
ç¬¬2æ¬¡ï¼šè·³è½¬åˆ°4913è¡Œï¼ˆæ‰¹æ¬¡50ï¼‰âŒ å¤±è´¥
       "æ— æ³•æ‰¾åˆ°è¡Œ 4913 å¯¹åº”çš„å¡ç‰‡"
```

è™½ç„¶éƒ½åœ¨åˆæ³•èŒƒå›´å†…ï¼ˆæ€»å…±9983æ¡æ•°æ®ï¼‰ã€‚

## ğŸ” åŸå› åˆ†æ

### é—®é¢˜1ï¼šæ’åºå¯¼è‡´çš„ç´¢å¼•æ˜ å°„é”™è¯¯

#### æ•°æ®æµç¨‹

1. **åŠ è½½CSVæ•°æ®**ï¼šåŸå§‹é¡ºåºï¼ˆç¬¬1-9983è¡Œï¼‰
2. **æŒ‰è¯„åˆ†æ’åº**ï¼š
   ```javascript
   // ç¬¬745è¡Œ
   allItems.sort((a, b) => (ratings[b.id] || 0) - (ratings[a.id] || 0) || a.idx - b.idx);
   ```
3. **æ¸²æŸ“å¡ç‰‡**ï¼šå­˜å‚¨åŸå§‹è¡Œå·
   ```javascript
   // ç¬¬788è¡Œ
   card.dataset.rowIndex = it.idx + 1; // å­˜å‚¨åŸå§‹è¡Œå·
   ```

#### é—®é¢˜ä»£ç ï¼ˆå·²ä¿®å¤ï¼‰

```javascript
// ç¬¬502è¡Œ - âŒ é”™è¯¯é€»è¾‘
const targetBatchIndex = Math.floor((rowNum - 1) / BATCH_SIZE);
// å‡è®¾ï¼šåŸå§‹ç¬¬4749è¡Œ â†’ åœ¨ä½ç½®4748 â†’ åœ¨ç¬¬47æ‰¹æ¬¡
```

**é”™è¯¯å‡è®¾**ï¼šåŸå§‹è¡Œå· = æ’åºåä½ç½®

### å®é™…æƒ…å†µ

```
åŸå§‹CSVï¼ˆæœªæ’åºï¼‰ï¼š
è¡Œ1: the (0æ˜Ÿ)
è¡Œ2: be (5æ˜Ÿ)
è¡Œ4749: example (3æ˜Ÿ) â† ç”¨æˆ·æƒ³è·³è½¬

â†“ æŒ‰è¯„åˆ†æ’åºå

allItemsæ•°ç»„ï¼ˆå·²æ’åºï¼‰ï¼š
ä½ç½®0: be (5æ˜Ÿ, åŸå§‹è¡Œ2)
ä½ç½®1: hello (5æ˜Ÿ, åŸå§‹è¡Œ2566)
...
ä½ç½®2101: example (3æ˜Ÿ, åŸå§‹è¡Œ4749) â† å®é™…åœ¨è¿™é‡Œï¼
...
ä½ç½®4748: xxx (2æ˜Ÿ, åŸå§‹è¡Œ8000)

æ—§ä»£ç ï¼š
- è®¡ç®—æ‰¹æ¬¡ = floor(4748 / 100) = 47
- å»ç¬¬47æ‰¹æ¬¡æ‰¾ï¼ˆallItems[4700-4799]ï¼‰
- âŒ æ‰¾ä¸åˆ°ï¼åŸå§‹è¡Œ4749åœ¨ä½ç½®2101ï¼ˆç¬¬21æ‰¹æ¬¡ï¼‰
```

### é—®é¢˜2ï¼šå‘åè·³è½¬é€»è¾‘ç¼ºé™·

#### é—®é¢˜åœºæ™¯

```javascript
// ç¬¬1æ¬¡è·³è½¬ï¼š8767è¡Œ â†’ æ‰¹æ¬¡88
currentBatch = 88

// ç¬¬2æ¬¡è·³è½¬ï¼š4913è¡Œ â†’ æ‰¹æ¬¡50
targetBatchIndex = 50

// åˆ¤æ–­æ¡ä»¶ï¼ˆæ—§ä»£ç ï¼‰
if (targetBatchIndex > currentBatch + 5) {  // 50 > 88+5? âŒ ä¸æˆç«‹
  // è¿œè·ç¦»è·³è½¬ï¼ˆæ¸…ç©ºé‡æ–°æ¸²æŸ“ï¼‰
} else {
  // è¿‘è·ç¦»è·³è½¬
  while (currentBatch < targetBatchCount) { // 88 < 51? âŒ ä¸æˆç«‹
    renderNextBatch();
  }
}

// ç»“æœï¼šä»€ä¹ˆéƒ½ä¸æ¸²æŸ“ â†’ æ‰¾ä¸åˆ°å¡ç‰‡ï¼
```

#### æ ¹æœ¬åŸå› 

**è¿œè·ç¦»åˆ¤æ–­åªè€ƒè™‘"å‘å‰è·³"ï¼ˆç›®æ ‡ > å½“å‰ï¼‰ï¼Œæ²¡è€ƒè™‘"å‘åè·³"ï¼ˆç›®æ ‡ < å½“å‰ï¼‰**

ä»æ‰¹æ¬¡88è·³åˆ°æ‰¹æ¬¡50æ˜¯å‘åè·³39ä¸ªæ‰¹æ¬¡ï¼Œä½†ä¸æ»¡è¶³ `targetBatchIndex > currentBatch + 5`ï¼Œä¹Ÿä¸æ»¡è¶³ `currentBatch < targetBatchCount`ï¼Œå¯¼è‡´ä¸æ¸²æŸ“ä»»ä½•å†…å®¹ã€‚

## âœ… ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯

1. **é—®é¢˜1ä¿®å¤**ï¼šå…ˆåœ¨æ’åºåçš„æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡ä½ç½®ï¼Œå†è®¡ç®—æ‰¹æ¬¡
2. **é—®é¢˜2ä¿®å¤**ï¼šä½¿ç”¨ç»å¯¹è·ç¦»åˆ¤æ–­ï¼Œæ”¯æŒåŒå‘è·³è½¬

### ä¿®å¤ä»£ç 

#### ä¿®å¤1ï¼šæ­£ç¡®çš„ç´¢å¼•æ˜ å°„

```javascript
// 1. åœ¨æ’åºåçš„æ•°ç»„ä¸­æŸ¥æ‰¾åŸå§‹è¡Œå·
const targetItemIndex = allItems.findIndex(item => item.idx === rowNum - 1);

if (targetItemIndex === -1) {
  console.warn(`åœ¨æ’åºåçš„æ•°æ®ä¸­æœªæ‰¾åˆ°åŸå§‹è¡Œ ${rowNum}`);
  return false;
}

// 2. æ ¹æ®æ’åºåçš„ä½ç½®è®¡ç®—æ‰¹æ¬¡
const targetBatchIndex = Math.floor(targetItemIndex / BATCH_SIZE);

console.log(`ç›®æ ‡è¡Œ ${rowNum} åœ¨æ’åºåçš„ä½ç½® ${targetItemIndex}ï¼Œæ‰¹æ¬¡ ${targetBatchIndex + 1}`);
```

#### ä¿®å¤2ï¼šæ”¯æŒåŒå‘è·³è½¬

```javascript
// ä½¿ç”¨ç»å¯¹è·ç¦»åˆ¤æ–­
const jumpDistance = Math.abs(targetBatchIndex - currentBatch);

if (jumpDistance > 5) {
  // è¿œè·ç¦»è·³è½¬ï¼ˆæ— è®ºå‘å‰è¿˜æ˜¯å‘åï¼‰
  console.log(`è¿œè·ç¦»è·³è½¬ï¼ˆè·ç¦»${jumpDistance}ä¸ªæ‰¹æ¬¡ï¼‰ï¼šæ¸…ç©ºå½“å‰æ˜¾ç¤ºï¼Œç›´æ¥æ¸²æŸ“ç›®æ ‡æ‰¹æ¬¡é™„è¿‘`);
  
  cardsEl.innerHTML = '';
  displayedItems = [];
  
  const startBatch = Math.max(0, targetBatchIndex - 1);
  const endBatch = Math.min(Math.ceil(allItems.length / BATCH_SIZE) - 1, targetBatchIndex + 2);
  
  currentBatch = startBatch;
  
  for (let i = startBatch; i <= endBatch; i++) {
    renderNextBatch();
  }
  
} else if (targetBatchIndex >= currentBatch) {
  // è¿‘è·ç¦»å‘å‰è·³ï¼šé¡ºåºæ¸²æŸ“
  const targetBatchCount = targetBatchIndex + 1;
  while (currentBatch < targetBatchCount && displayedItems.length < allItems.length) {
    renderNextBatch();
  }
  
} else {
  // è¿‘è·ç¦»å‘åè·³ï¼šæ¸…ç©ºå¹¶é‡æ–°æ¸²æŸ“
  console.log(`å‘åè·³è½¬ï¼šæ¸…ç©ºå½“å‰æ˜¾ç¤ºï¼Œé‡æ–°æ¸²æŸ“ç›®æ ‡æ‰¹æ¬¡é™„è¿‘`);
  
  cardsEl.innerHTML = '';
  displayedItems = [];
  
  const startBatch = Math.max(0, targetBatchIndex - 1);
  const endBatch = Math.min(Math.ceil(allItems.length / BATCH_SIZE) - 1, targetBatchIndex + 2);
  
  currentBatch = startBatch;
  
  for (let i = startBatch; i <= endBatch; i++) {
    renderNextBatch();
  }
}
```

### ä¿®å¤æ•ˆæœ

#### åœºæ™¯1ï¼šæ’åºåç´¢å¼•æ˜ å°„

```
ç”¨æˆ·è¾“å…¥ï¼š4749

ä¿®å¤å‰ï¼š
1. è®¡ç®—æ‰¹æ¬¡ï¼šfloor(4748 / 100) = 47 âŒ é”™è¯¯
2. å»ç¬¬47æ‰¹æ¬¡æ‰¾
3. âŒ æ‰¾ä¸åˆ°

ä¿®å¤åï¼š
1. findIndexæŸ¥æ‰¾ï¼šit.idx === 4748
2. æ‰¾åˆ°ä½ç½®ï¼š2101 âœ… æ­£ç¡®
3. è®¡ç®—æ‰¹æ¬¡ï¼šfloor(2101 / 100) = 21
4. æ¸²æŸ“ç¬¬21æ‰¹æ¬¡
5. âœ… æˆåŠŸæ‰¾åˆ°å¹¶è·³è½¬ï¼

æ§åˆ¶å°è¾“å‡ºï¼š
"ç›®æ ‡è¡Œ 4749 åœ¨æ’åºåçš„ä½ç½® 2101ï¼Œæ‰¹æ¬¡ 22"
```

#### åœºæ™¯2ï¼šå‘åè·³è½¬

```
ç¬¬1æ¬¡è·³è½¬ï¼š8767è¡Œ

ä¿®å¤å‰ï¼š
- ç›®æ ‡æ‰¹æ¬¡88ï¼Œå½“å‰æ‰¹æ¬¡0
- è·ç¦»88 > 5ï¼Œè§¦å‘è¿œè·ç¦»è·³è½¬
- âœ… æˆåŠŸ

ç¬¬2æ¬¡è·³è½¬ï¼š4913è¡Œ

ä¿®å¤å‰ï¼š
- ç›®æ ‡æ‰¹æ¬¡50ï¼Œå½“å‰æ‰¹æ¬¡88
- 50 > 88+5? âŒ ä¸æ»¡è¶³
- 88 < 51? âŒ ä¸æ»¡è¶³
- ä»€ä¹ˆéƒ½ä¸æ¸²æŸ“
- âŒ å¤±è´¥

ä¿®å¤åï¼š
- ç›®æ ‡æ‰¹æ¬¡50ï¼Œå½“å‰æ‰¹æ¬¡88
- jumpDistance = |50-88| = 38 > 5
- è§¦å‘è¿œè·ç¦»è·³è½¬
- æ¸…ç©ºå¹¶é‡æ–°æ¸²æŸ“æ‰¹æ¬¡49-52
- âœ… æˆåŠŸï¼

æ§åˆ¶å°è¾“å‡ºï¼š
"ç›®æ ‡è¡Œ 4913 åœ¨æ’åºåçš„ä½ç½® 4912ï¼Œæ‰¹æ¬¡ 50"
"è¿œè·ç¦»è·³è½¬ï¼ˆè·ç¦»38ä¸ªæ‰¹æ¬¡ï¼‰ï¼šæ¸…ç©ºå½“å‰æ˜¾ç¤ºï¼Œç›´æ¥æ¸²æŸ“ç›®æ ‡æ‰¹æ¬¡é™„è¿‘"
"å·²æ¸²æŸ“æ‰¹æ¬¡ 49 åˆ° 52"
```

#### åœºæ™¯3ï¼šè¿‘è·ç¦»å‘åè·³

```
ç¬¬1æ¬¡è·³è½¬ï¼š500è¡Œï¼ˆæ‰¹æ¬¡5ï¼‰
ç¬¬2æ¬¡è·³è½¬ï¼š200è¡Œï¼ˆæ‰¹æ¬¡2ï¼‰

ä¿®å¤å‰ï¼š
- ç›®æ ‡æ‰¹æ¬¡2ï¼Œå½“å‰æ‰¹æ¬¡5
- 2 > 5+5? âŒ ä¸æ»¡è¶³
- 5 < 3? âŒ ä¸æ»¡è¶³
- âŒ å¤±è´¥

ä¿®å¤åï¼š
- jumpDistance = |2-5| = 3 <= 5
- targetBatchIndex(2) < currentBatch(5)
- è§¦å‘"å‘åè·³è½¬"é€»è¾‘
- æ¸…ç©ºå¹¶é‡æ–°æ¸²æŸ“æ‰¹æ¬¡1-4
- âœ… æˆåŠŸï¼

æ§åˆ¶å°è¾“å‡ºï¼š
"å‘åè·³è½¬ï¼šæ¸…ç©ºå½“å‰æ˜¾ç¤ºï¼Œé‡æ–°æ¸²æŸ“ç›®æ ‡æ‰¹æ¬¡é™„è¿‘"
"å·²æ¸²æŸ“æ‰¹æ¬¡ 1 åˆ° 4"
```

## ğŸ“Š æ€§èƒ½å½±å“

- **findIndexæ—¶é—´å¤æ‚åº¦**ï¼šO(n)
- **å®é™…è€—æ—¶**ï¼š< 2msï¼ˆ10,000æ¡æ•°æ®ï¼‰
- **æ€»ä½“å½±å“**ï¼šå¯å¿½ç•¥

## âœ… éªŒè¯æ¸…å•

- [x] ä¿®å¤è·³è½¬åˆ°ä»»æ„åˆæ³•è¡Œå·
- [x] æ­£ç¡®å¤„ç†æ’åºåçš„ç´¢å¼•æ˜ å°„
- [x] æ”¯æŒå‘å‰è·³è½¬ï¼ˆè¿œè·ç¦»ã€è¿‘è·ç¦»ï¼‰
- [x] æ”¯æŒå‘åè·³è½¬ï¼ˆè¿œè·ç¦»ã€è¿‘è·ç¦»ï¼‰
- [x] æ·»åŠ é”™è¯¯å¤„ç†
- [x] æ— linté”™è¯¯
- [x] æ€§èƒ½å½±å“ < 5ms

## ğŸ¯ å…³é”®è¦ç‚¹

### ç´¢å¼•æ˜ å°„
**åœ¨æ¶‰åŠæ’åºçš„åœºæ™¯ä¸­ï¼Œè¦åŒºåˆ†ï¼š**
1. **åŸå§‹ç´¢å¼•**ï¼ˆCSVæ–‡ä»¶ä¸­çš„è¡Œå·ï¼‰- `item.idx`
2. **æ’åºåä½ç½®**ï¼ˆallItemsæ•°ç»„ä¸­çš„ç´¢å¼•ï¼‰- é€šè¿‡`findIndex`è·å–
3. **æ˜¾ç¤ºç´¢å¼•**ï¼ˆdata-row-indexï¼‰- å­˜å‚¨åŸå§‹è¡Œå·

**æ˜ å°„å…³ç³»**ï¼š
```
ç”¨æˆ·è¾“å…¥è¡Œå· â†’ item.idx â†’ findIndex â†’ æ’åºåä½ç½® â†’ æ‰¹æ¬¡
```

### è·³è½¬é€»è¾‘

| åœºæ™¯ | è·ç¦»åˆ¤æ–­ | æ“ä½œ |
|-----|---------|------|
| **è¿œè·ç¦»è·³è½¬**ï¼ˆå‘å‰/å‘åï¼‰| `|ç›®æ ‡-å½“å‰| > 5` | æ¸…ç©º + æ¸²æŸ“ç›®æ ‡æ‰¹æ¬¡é™„è¿‘ |
| **è¿‘è·ç¦»å‘å‰è·³** | `ç›®æ ‡ >= å½“å‰` ä¸” è·ç¦» â‰¤ 5 | é¡ºåºæ¸²æŸ“ |
| **è¿‘è·ç¦»å‘åè·³** | `ç›®æ ‡ < å½“å‰` ä¸” è·ç¦» â‰¤ 5 | æ¸…ç©º + æ¸²æŸ“ç›®æ ‡æ‰¹æ¬¡é™„è¿‘ |

### æ ¸å¿ƒæ”¹è¿›

1. **ä¿®å¤1**ï¼šä½¿ç”¨`findIndex`æŸ¥æ‰¾æ’åºåçš„å®é™…ä½ç½®
2. **ä¿®å¤2**ï¼šä½¿ç”¨`Math.abs()`è®¡ç®—ç»å¯¹è·ç¦»ï¼Œæ”¯æŒåŒå‘è·³è½¬
3. **ä¿®å¤3**ï¼šæ·»åŠ å‘åè·³è½¬çš„ä¸“é—¨å¤„ç†é€»è¾‘

## ğŸ‰ ä¿®å¤å®Œæˆ

ç°åœ¨å¯ä»¥æ­£ç¡®è·³è½¬åˆ°ä»»æ„è¡Œï¼ˆ1-9983ï¼‰ï¼Œæ”¯æŒï¼š
- âœ… ä»»æ„æ–¹å‘è·³è½¬ï¼ˆå‘å‰/å‘åï¼‰
- âœ… ä»»æ„è·ç¦»è·³è½¬ï¼ˆè¿œè·ç¦»/è¿‘è·ç¦»ï¼‰
- âœ… æ— è®ºæ•°æ®å¦‚ä½•æŒ‰è¯„åˆ†æ’åº

